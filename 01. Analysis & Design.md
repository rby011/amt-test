# Analysis & Design for 'AMT Test Automation'

1. TestSuite 를 `식별`한다 (* **영철님 스킴 파일에 따라 보완**)

- 목적
  (1) TestSuite 가 어디에 위치하고 있는지 `식별`한다

  (2) Test Suite 를 구조화하여 `식별`한다

  (3) Tes Suite 별로 세부 구조 정보를 `식별`한다
- 입력: (1) ~ (3) 내용으로 구성된 파일
- 출력: `메모리`에 아래의 형태로 구성된 `TestSuite` 목록을 올림


  |   구분   | 정보 개수 |   정보 유형   | 데이터 유형 |                비고                |
  | :--------: | :---------: | :-------------: | :-----------: | :-----------------------------------: |
  |    id    |     1     |   식별 정보   |   문자열   |             포멧은 TBD             |
  |         |     1     | 사용 시나리오 |   문자열   | call, meeting, presentation, etc 등 |
  |   음성   |     1     |   파일 경로   |   문자열   |                                     |
  |         |     1     |     언어     |   문자열   |            ISO 표준 형식            |
  |         |     1     |   녹음 조건   |   문자열   |  차폐 환경, 블루투스 통화 환경 등  |
  |         |     1     |   파일 포멧   |   문자열   |             PCM, WAV 등             |
  |         |     1     |  샘플링 비율  | 부동소수점 |                                     |
  |         |     1     |   비트 깊이   | 부동소수점 |                                     |
  |         |     1     |   재생 시간   | 부동소수점 |                                     |
  |         |     1     |   발화 시간   | 부동소수점 |                                     |
  | 스크립트 |     1     |   파일 경로   |   문자열   |                                     |
  |         |     1     |     언어     |   문자열   |            ISO 표준 형식            |
  |         |     1     |     문체     |   문자열   |        구어체, 문어체, 혼합        |
  |         |     1     |   문장 길이   |    정수    |              공백 포함              |
  |         |   0..1   |   토큰 개수   |    정수    |                                     |
  |  번역문  |   3..*   |   파일 경로   |   문자열   |                                     |
  |         |   3..*   |     언어     |   문자열   |            ISO 표준 형식            |
  |         |   3..*   |   문장 길이   |    정수    |              공백 포함              |
  |         |   0..1   |   토큰 개수   |    정수    |                                     |

2. Test Planning 을 한다

- 목적
  (1) `테스트 대상(ASR , MT)`을 선정한다

  (2) `테스트 유형(단위, 통합, 심화)`을 선정한다

  - 단위 테스트 정의 * EUT : Engine Under Testing
    - EUT(ASR-INT 포함)에 음성 파일과 필요 정보를 입력하여 ASR 모듈 출력(전사 텍스트)과 성능 지표(WRR)를 도출
    - EUT(MT)에 스크립트와 필요 정보를 입력하여 MT 모듈 출력(번역 텍스트)과 성능 지표(BLEU)를 도출
  - 통합 테스트 정의
    - EUT(ASR-INT 제외)에 음성 파일과 필요 정보를 입력하여 ASR 모듈 출력(전사 텍스트)과 성능 지표(WRR)를 도출
    - EUT(MT) 에 EUT(ASR-INT 포함)의 출력 결과 중 전사 텍스트를 입력하여 MT 모듈 출력(번역 텍스트)과 성능 지표(BLEU)를 도출
    - EUT(MT) 에 EUT(ASR-INT 제외)의 출력 결과 중 전사 텍스트를 입력하여 MT 모듈 출력(번역 텍스트)과 성능 지표(BLEU)를 도출
  - 심화 테스트 정의 * (삼학님 요구 기능에 따라 수정/보완)
    - 샘플링 비율 조정, 발화 휴지 시간 조정 等 음원의 수정/추가 확보를 통한 단위/통합 시험을 수행하는 것

  (3) 테스트에 사용할 `TestSuite` 의 부분 집합을 선정한다

  (4) 테스트 결과를 가지고 수행할 분석할 유형을 선정한다 (분석은 결과를 가지고 여러번 수행할 수 있으나 여기서 선정하는 것은 테스트 결과 수행 후 즉시 함께 수행되는 분석을 의미한다)

  - 분석 유형 (단순 출력을 하면서 기본 분석을 하고 심화 분석을 할 수 있다)

    - 기본 분석 : 단위 테스트, 통합 테스트이 Test Case 별 모듈 출력과 성능 지표를 시험 유형별로 아래 기준으로 그룹핑 정렬하여 결과를 출력


      | 시험유형 |   구분   |                                                              분석 내용                                                              | 분석 결과 출력 방식 |
      | ---------- | :--------: | :-----------------------------------------------------------------------------------------------------------------------------------: | :-------------------: |
      | 단위     |   기본   |                                                     (1) 전체 평균, 중위값, 편차                                                     |  텍스트, Box Plot  |
      |          |         |                                               (2) 사용 시나리오 별 평균, 중위값, 편차                                               |  텍스트, Box Plot  |
      |          |         |                                                (3) 녹음 조건 별, 평균, 중위값, 편차                                                |  텍스트, Box Plot  |
      |          |         |                                         (4) 발화 시간(또는 재생 시간) 별 평균, 중위값, 편차                                         |  텍스트, Box Plot  |
      |          |         |                                         (5) 문장 길이(또는 토큰 개수) 별 평균, 중위값, 편차                                         |  텍스트, Box Plot  |
      |          |   복합   | (6) {사용 시나리오, 녹음 조건, 발화 시간, 문장 길이}<br /><br /> 모든 컴비네이션을 도출하고 각 컴비네이션이션 별 평균, 중위값, 편차 |  텍스트, Box Plot  |
      |          | 문제발화 |                      기본, 복합 분석 결과 5% Percentile 혹은 특정 지표 수준 아래의 발화 및 음성 파일 목록 제공                      |       테이블       |
      | 통합     |   기본   |                          EUT (MT) 에 EUT(ASR-ITN포함) 의 출력 텍스트를 입력한 결과를 대상으로 위 (1) ~ (5)                          |  텍스트, Box Plot  |
      |          |   복합   |                             EUT (MT) 에 EUT(ASR-ITN포함) 의 출력 텍스트를 입력한 결과를 대상으로 위 (6)                             |  텍스트, Box Plot  |
      |          | 문제발화 |                     기본, 복합 분석 결과 5% Percentile 혹은 특정 지표 수준의 아래의 발화 및 음성 파일 목록 제공                     |       테이블       |
      | 비교     |   기본   |                          EUT (MT) 에 EUT(ASR-ITN제외) 의 출력 텍스트를 입력한 결과를 대상으로 위 (1) ~ (5)                          |  텍스트, Box Plot  |
      |          |   복합   |                             EUT (MT) 에 EUT(ASR-ITN제외) 의 출력 텍스트를 입력한 결과를 대상으로 위 (6)                             |  텍스트, Box Plot  |
      |          | 문제발화 |                     기본, 복합 분석 결과 5% Percentile 혹은 특정 지표 수준의 아래의 발화 및 음성 파일 목록 제공                     |       테이블       |
    - 심화 분석 : TBD (심화 테스트 수행 여부에 따라 상세화)

  (5) 선정된 테스트 대상과 유형에 따라 `TestCase` 를 구성 한다
- 입력: (1) ~ (3) 이 기술된 파일


  |      필드      | 개수 |                내용                | 유형 |                   값                   | 비고                                                                                                                                    |
  | :---------------: | :----: | :----------------------------------: | :----: | :--------------------------------------: | ----------------------------------------------------------------------------------------------------------------------------------------- |
  |   test-types   |  1  |          테스트할 유형들          | set |   {`UNIT`, `INTEGRATION`, `COMPARE`}   | `COMPARE` 가 수행되려면 `ASR-ONLY`가 있어야 함                                                                                          |
  | suites-excluded | 0..1 |   제외할 Test Suite 식별자 목록   | set |            {test-suite id}            | 기본 값은 exclusion 할<br /> test-suite 가 없은 것                                                                                      |
  |      euts      |  1  |       테스트 대상 엔진 목록       | set |     {`MT`, `ASR-FULL`, `ASR-ONLY`}     | `ASR-FULL` 전체 엔진.<br /><br /><br />`ASR-ONLY`는 ITN 없는 엔진 <br /><br />`ASR-ONLY` 있어도 `COMPARE` 없으면 아무일도 일어나지 않음 |
  | result-analysis | 0..1 | 기본, 복합, 문제발화로 구성된 집합 | set | {`BASIC`, `COMPOSITION`, `EXTRACTION`} | 기본 값은`BASIC`                                                                                                                        |
- 출력: 시험 유형과 EUT 별로 `TestCase` 집합을 구성하여 메모리에 로딩하고 `TestCase` 수행 완료 후 분석할 유형을 메모리에 로딩한다

  - 단위 시험 : ASR-FULL * 녹음 조건, 재생시간, 문장 길이 필드 추가 필요성 검토


    | 필드             | 개수 | 내용                            | 유형   | 값                               | 비고                                              |
    | ------------------ | :----: | --------------------------------- | -------- | ---------------------------------- | --------------------------------------------------- |
    | testcase-id      |  1  | `TestCase` 식별자               | string | {type-types}-ASR-FULL-{sequence} |                                                   |
    | testsuite-id     |  1  | 참조하고 있는`TestSuite` 식별자 | string |                                  | TBD                                               |
    | audio-file-path  |  1  | 음성 파일 경로                  | string | test suite 에 있는 {파일경로}    |                                                   |
    | script-file-path |  1  | 음성 스크립트 파일 경로         | string |                                  |                                                   |
    | src-lang         |  1  | 음성 스크립트 언어              | string | ISO 표준 형식                    | 언어 감지 능력 테스트 위해서는 이거 사용하면 않됨 |
  - 단위 시험 : ASR-ONLY * 녹음 조건, 재생시간, 문장 길이 필드 추가 필요성 검토


    | 필드             | 개수 | 내용                            | 유형   | 값                               | 비고                                              |
    | ------------------ | :----: | --------------------------------- | -------- | ---------------------------------- | --------------------------------------------------- |
    | testcase-id      |  1  | `TestCase` 식별자               | string | {type-types}-ASR-FULL-{sequence} |                                                   |
    | testsuite-id     |  1  | 참조하고 있는`TestSuite` 식별자 | string |                                  | TBD                                               |
    | audio-file-path  |  1  | 음성 파일 경로                  | string | test suite 에 있는 {파일경로}    |                                                   |
    | script-file-path |  1  | 음성 스크립트 파일 경로         | string |                                  |                                                   |
    | language         |  1  | 음성 스크립트 언어              | string | ISO 표준 형식                    | 언어 감지 능력 테스트 위해서는 이거 사용하면 않됨 |
  - 단위 시험 : MT * 문장 길이 필드 등 추가 필요성 검토


    | 필드                | 개수 | 내용                                            | 유형   | 값                               | 비고                                              |
    | --------------------- | :----: | ------------------------------------------------- | -------- | ---------------------------------- | --------------------------------------------------- |
    | testcase-id         |  1  | `TestCase` 식별자                               | string | {type-types}-ASR-FULL-{sequence} |                                                   |
    | testsuite-id        |  1  | 참조하고 있는`TestSuite` 식별자                 | string |                                  | TBD                                               |
    | src-lang            |  1  | 입력 텍스트 언어                                | string | ISO 표준 형식                    | 언어 감지 기능 테스트 위해서는 이거 사용하면 않됨 |
    | dst-lang            |  1  | 번역할 목적 언어                                | string | ISO 표준 형식                    |                                                   |
    | src-text-file-path  |  1  | 입력 텍스트 언어                                |        |                                  |                                                   |
    | ref-text-file-paths | 3..* | BLEU 측정할 참조 문장 텍스트 파일들의 경로 집합 | set    |                                  |                                                   |
    |                     |     |                                                 |        |                                  |                                                   |
  - 통합 시험 * 녹음 조건, 재생시간, 문장 길이 필드 추가 필요성 검토, 그리고 언어 설정 방식 문의 필요!!


    | 필드                | 개수 | 내용                                            | 유형   | 값                               | 비고 |
    | --------------------- | :----: | ------------------------------------------------- | -------- | ---------------------------------- | ------ |
    | testcase-id         |  1  | `TestCase` 식별자                               | string | {type-types}-ASR-FULL-{sequence} |      |
    | testsuite-id        |  1  | 참조하고 있는`TestSuite` 식별자                 | string |                                  | TBD  |
    | src-lang            |  1  | 입력 텍스트 언어                                | string | ISO 표준 형식                    |      |
    | dest-lang           |  1  | 번역할 목적 언어                                | string | ISO 표준 형식                    |      |
    | src-text-file-path  |  1  | 입력 텍스트 언어                                |        |                                  |      |
    | ref-text-file-paths |  1  | BLEU 측정할 참조 문장 텍스트 파일들의 경로 집합 | set    |                                  |      |
    | audio-file-path     |  1  |                                                 |        |                                  |      |
    |                     |     |                                                 |        |                                  |      |
    |                     |     |                                                 |        |                                  |      |
  - 비교 시험 * 비교시험 할지 여부 검토해서 진행


    | 필드 | 개수 | 내용 | 데이터 유형 | 값 | 비고 |
    | ------ | ------ | ------ | ------------- | ---- | ------ |
    | TBD  |      |      |             |    |      |
    | TBD  |      |      |             |    |      |

4. Test 를 수행한다

- 목적 : `TestCase` 를 모두 수행하고 EUT 의 출력과 지표를 산출한다
- 입력 : `TestCase` 집합
- 출력 : `TestCase` 별 EUT 출력과 수행로그, 출력에 대한 지표 산출 결과를 포함한 `TestResult`

  - 단위 시험 : ASR-FULL * 녹음 조건, 재생시간, 문장 길이 필드 추가 필요성 검토


    | 필드           | 개수 | 내용                                     | 데이터 유형 | 값                  | 비고                 |
    | ---------------- | ------ | ------------------------------------------ | ------------- | --------------------- | ---------------------- |
    | testcase-id    | 1    | `TestCase` 식별자                        | string      |                     | 위 정의 따름         |
    | testsuite-id   | 1    | `TestSuite` 식별자                       | string      |                     | 위 정의 따름         |
    | out-transcript | 1    | EUT 가 출력한 전사 결과 텍스트           | string      |                     |                      |
    | ref-transcript | 1    | 음석 녹음시 사용한 스크립트 텍스트       | string      |                     |                      |
    | log            | 1    | EUT 가 수행하면서 출력하는 텍스트        | string      |                     |                      |
    | metrics        | 1..* | metric-name 과 metric-value pair 의 집합 | set         |                     |                      |
    | metric-name    | 1    | 전사 결과 텍스트                         | string      | `WRR`, `WER`, `SRR` | `SRR` 은 문장 인식율 |
    | metric-value   | 1    |                                          | float       | 지표 산출값         |                      |
    | //             |      |                                          |             |                     |                      |
  - 단위 시험 : ASR-ONLY * 녹음 조건, 재생시간, 문장 길이 필드 추가 필요성 검토


    | 필드           | 개수 | 내용                                         | 데이터 유형 | 값                  | 비고                 |
    | ---------------- | ------ | ---------------------------------------------- | ------------- | --------------------- | ---------------------- |
    | testcase-id    | 1    | `TestCase` 식별자                            | string      |                     | 위 정의 따름         |
    | testsuite-id   | 1    | `TestSuite` 식별자                           | string      |                     | 위 정의 따름         |
    | out-transcript | 1    | EUT 가 출력한 전사 결과 텍스트               | string      |                     |                      |
    | ref-transcript | 1    | 음석 녹음시 사용한 스크립트 텍스트           | string      |                     |                      |
    | log            | 1    | EUT 가 수행하면서 출력하는 텍스트            | string      |                     |                      |
    | metrics        | 1..* | `metric-name` 과 `metric-value` pair 의 집합 | set         |                     |                      |
    | metric-name    | 1    | 지표 이름                                    | string      | `WRR`, `WER`, `SRR` | `SRR` 은 문장 인식율 |
    | metric-value   | 1    | 지표 산출값                                  | float       | 지표 산출값         |                      |
    | //             |      |                                              |             |                     |                      |
  - 단위 시험 : MT * 문장 길이 필드 등 추가 필요성 검토


    | 필드            | 개수 | 내용                                         | 데이터 유형 | 값               | 비고         |
    | ----------------- | ------ | ---------------------------------------------- | ------------- | ------------------ | -------------- |
    | testcase-id     | 1    | `TestCase` 식별자                            | string      |                  | 위 정의 따름 |
    | testsuite-id    | 1    | `TestSuite` 식별자                           | string      |                  | 위 정의 따름 |
    | src-lang        | 1    |                                              | string      |                  |              |
    | dst-lang        | 1    |                                              | string      |                  |              |
    | log             | 1    | EUT 가 수행하면서 출력하는 텍스트            | string      |                  |              |
    | out-translation | 1    | EUT 가 출력한 전사 결과 텍스트               | set         |                  |              |
    | ref-translation | 1..* | BLEU 지표 산출 위한 번역 텍스트 쌍           | set         |                  |              |
    | metrics         | 1..* | `metric-name` 과 `metric-value` pair 의 집합 | set         |                  |              |
    | metric-name     | 1    | 지표 이름                                    | string      | `BLEU`, `COMMET` |              |
    | metric-value    | 1    | 지표 산출값                                  | float       |                  |              |
    | //              |      |                                              |             |                  |              |
  - 통합 시험 : * 녹음 조건, 재생시간, 문장 길이 필드 추가 필요성 검토


    | 필드           | 개수 | 내용                                     | 데이터 유형 | 값                  | 비고                 |
    | ---------------- | ------ | ------------------------------------------ | ------------- | --------------------- | ---------------------- |
    | testcase-id    | 1    | `TestCase` 식별자                        | string      |                     | 위 정의 따름         |
    | testsuite-id   | 1    | `TestSuite` 식별자                       | string      |                     | 위 정의 따름         |
    | out-transcript | 1    | EUT 가 출력한 전사 결과 텍스트           | string      |                     |                      |
    | ref-transcript | 1    | 음석 녹음시 사용한 스크립트 텍스트       | string      |                     |                      |
    | log            | 1    | EUT 가 수행하면서 출력하는 텍스트        | string      |                     |                      |
    | metrics        | 1..* | metric-name 과 metric-value pair 의 집합 | set         |                     |                      |
    | metric-name    | 1    | 전사 결과 텍스트                         | string      | `WRR`, `WER`, `SRR` | `SRR` 은 문장 인식율 |
    | metric-value   | 1    |                                          | float       | 지표 산출값         |                      |
    | //             |      |                                          |             |                     |                      |

6. 수행 결과를 분석한다

- 목적 :
- 입력 :
- 출력 :

7. 분석 결과를 출력한다

- 목적 :
- 입력 :
- 출력 :
